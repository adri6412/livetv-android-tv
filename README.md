# LiveTV - Digital Terrestrial Decoder for Android TV

An Android TV application that simulates a digital terrestrial decoder, capable of playing IPTV streams from M3U/M3U8 playlists derived from TVHeadend in passthrough mode, maintaining the original DVB-T2 signal via IP.

## Main Features

### 🔴 Video Playback
- **M3U/M3U8 Support**: Loading local and remote playlists
- **IPTV Streaming**: Playing digital terrestrial channels via IP
- **TVHeadend Compatibility**: Optimized for playlists generated by TVHeadend
- **HD/4K Quality**: Support for high definition streams
- **Multiple Codecs**: H.264, H.265/HEVC, MPEG-2

### 📺 Decoder Interface
- **Android TV UI**: Interface optimized for televisions
- **Remote Navigation**: Complete control with TV remote
- **Channel List**: Organized display by groups
- **Quick Channel Change**: Navigation with CH+/CH- keys
- **Channel Information**: Display number, name, quality, group

### 📋 TV Guide (EPG)
- **XMLTV Support**: Loading program guide from XML files
- **Current Program**: Real-time display
- **Next Program**: Programming preview
- **Program Search**: Filter by title and category
- **Local Cache**: Offline storage of EPG data

### ⚠️ HbbTV (Hybrid Broadcast Broadband TV) - DISABLED
- **Important Note**: HbbTV support is not fully implemented and is currently disabled
- **Status**: Feature in development, not usable in current version
- **Colored Keys**: Red/green/yellow/blue keys are present but non-functional
- **Planned**: Complete implementation in future versions

### ⚙️ Configuration Management
- **Multiple Playlists**: Management of multiple sources
- **Automatic Updates**: Periodic playlist/EPG downloads
- **Favorites**: Favorite channel management
- **Smart Cache**: Performance optimization
- **Backup/Restore**: Configuration saving

## Technical Architecture

### 🏗️ Main Components
- **Media3 (ExoPlayer)**: Video playback engine
- **Room Database**: Local data persistence
- **Kotlin Coroutines**: Asynchronous programming
- **MVVM Pattern**: Model-View-ViewModel architecture
- **Repository Pattern**: Data access abstraction

### 📱 Module Structure
```
app/
├── data/
│   ├── entity/          # Database entities (Channel, EPGProgram, Playlist)
│   ├── dao/             # Data Access Objects
│   ├── repository/      # Repository pattern
│   └── database/        # Room configuration
├── ui/
│   ├── main/           # Main screen
│   ├── player/         # Video player
│   ├── settings/       # Configurations
│   ├── epg/           # TV guide
│   └── hbbtv/         # HbbTV services (disabled)
├── utils/
│   ├── M3UParser       # M3U playlist parser
│   └── XMLTVParser     # XMLTV EPG parser
└── service/
    └── EPGService      # EPG download service
```

## Installation and Configuration

### 📋 Requirements
- Android TV 5.0+ (API 21+)
- Internet connection for IPTV streaming
- TVHeadend server configured (optional)

### 🚀 Initial Configuration
1. **Launch the application** on Android TV
2. **Go to Settings** (MENU key)
3. **Configure Playlist**:
   - Remote URL: `http://example-server:9981/playlist`
   - Local file: Select M3U file from storage
4. **Configure EPG** (optional):
   - XMLTV URL: `http://example-server:9981/xmltv`
5. **Test configuration** with "Test Playlist" button
6. **Save settings**

### 🔧 TVHeadend Configuration
To use with TVHeadend, configure:
```
# M3U Playlist
http://[example-server]:9981/playlist/channels.m3u

# EPG XMLTV  
http://[example-server]:9981/xmltv/channels.xml

# Stream passthrough
http://[example-server]:9981/stream/channel/[uuid]
```

## Usage

### 🎮 Remote Controls
- **↑↓**: Navigate channel list
- **ENTER**: Play selected channel
- **CH+/CH-**: Change channel during playback
- **MENU**: Open settings
- **GUIDE**: Open TV guide (EPG)
- **⭐**: Filter favorite channels
- **🔴🟢🟡🔵**: Colored keys (HbbTV disabled)
- **INFO**: Show channel information
- **BACK**: Go back

### 📺 Playback
1. **Select channel** from main list
2. **Press ENTER** to start playback
3. **Use CH+/CH-** to change channel
4. **Press ENTER** during playback for controls
5. **Colored keys** non-functional (HbbTV disabled)

### 📋 Favorites Management
1. **Select channel** in the list
2. **Long press ENTER** for context menu
3. **Add/Remove** from favorites
4. **⭐ key** to show only favorites

## Supported Formats

### 📼 M3U Playlist
```m3u
#EXTM3U
#EXTINF:-1 tvg-id="rai1" tvg-name="Rai 1" tvg-logo="logo.png" group-title="Rai",Rai 1 HD
http://example-server:9981/stream/channel/uuid1

#EXTINF:-1 tvg-id="canale5" tvg-name="Canale 5",Canale 5 HD
http://example-server:9981/stream/channel/uuid2
```

### 📋 EPG XMLTV
```xml
<?xml version="1.0" encoding="UTF-8"?>
<tv>
  <channel id="rai1">
    <display-name>Rai 1</display-name>
  </channel>
  <programme start="20231201200000 +0100" stop="20231201220000 +0100" channel="rai1">
    <title>TV Program</title>
    <desc>Program description</desc>
    <category>Entertainment</category>
  </programme>
</tv>
```

## Development

### 🛠️ Build Requirements
- Android Studio Arctic Fox+
- Kotlin 1.8+
- Gradle 8.0+
- Android SDK 34

### 📦 Main Dependencies
```gradle
// Media playback
implementation 'androidx.media3:media3-exoplayer:1.2.0'
implementation 'androidx.media3:media3-ui:1.2.0'

// Android TV
implementation 'androidx.leanback:leanback:1.0.0'

// Database
implementation 'androidx.room:room-runtime:2.6.0'
implementation 'androidx.room:room-ktx:2.6.0'

// Networking
implementation 'com.squareup.okhttp3:okhttp:4.12.0'

// Image loading
implementation 'com.github.bumptech.glide:glide:4.16.0'

// XML parsing
implementation 'org.jsoup:jsoup:1.16.2'
```

### 🔨 Build Commands
```bash
# Debug build
./gradlew assembleDebug

# Release build
./gradlew assembleRelease

# Install on device
./gradlew installDebug
```

### 🚀 Automated Builds (GitHub Actions)
The project includes automated GitHub Actions workflows for building APK files:

**Available Workflows:**
- **Build Release APK**: Automatic APK building on version tags
- **Build Signed Release APK**: Production-ready signed APKs
- **Run Tests**: Automated testing and lint checks

**Quick Start:**
```bash
# Create a version tag to trigger automatic build
git tag v1.5.32
git push origin v1.5.32
```

**Manual Trigger:**
- Go to GitHub Actions tab
- Select desired workflow
- Click "Run workflow"

For detailed setup instructions, see [`.github/README.md`](.github/README.md).

## Troubleshooting

### ❌ Common Issues

**No channels displayed**
- Verify M3U playlist URL
- Check internet connection
- Test playlist with "Test Playlist"

**Stream doesn't start**
- Verify supported stream format
- Check firewall/proxy
- Try with test stream

**EPG doesn't load**
- Verify XMLTV URL
- Check EPG file format
- Restart EPG service

**HbbTV doesn't work**
- **Note**: HbbTV is disabled in current version
- Feature is in development for future versions
- Colored keys are non-functional

### 📊 Logs and Debug
Application logs are available via:
```bash
adb logcat | grep "LiveTV"
```

## Roadmap

### 🚧 Future Features
- [ ] **Complete HbbTV**: Complete implementation of interactive services

## License

This project is released under Mozilla Public License 2.0 (MPL 2.0). See `LICENSE` file for details.

### Key Points of MPL 2.0:
- ✅ **Commercial use allowed** - Companies can use and sell products with LiveTV
- ✅ **File-level copyleft** - Only modified files must be shared back
- ✅ **Linking freedom** - Can be linked with proprietary software
- ✅ **Contributions protected** - Modifications to LiveTV files must be shared

### Third-Party Dependencies
This project uses third-party libraries with compatible licenses. See `THIRD_PARTY_LICENSES` file for complete license information of all dependencies.

**License Summary:**
- **AndroidX/Media3**: Apache 2.0 (compatible)
- **Retrofit/OkHttp**: Apache 2.0 (compatible)
- **Jellyfin FFmpeg**: LGPL 2.1+ (compatible via linking)
- **Glide**: BSD License (compatible)
- **JSoup**: MIT License (compatible)
- **Testing libraries**: Apache 2.0/MIT (compatible)

All dependencies are legally compatible with MPL 2.0.

## Contributing

Contributions are welcome! To contribute:
1. Fork the repository
2. Create feature branch
3. Commit changes
4. Push to branch
5. Open Pull Request

---

**LiveTV** - Bring digital terrestrial to Android TV! 📺✨